# **SN74HC165 Shift Register Driver**

This driver allows ArduPilot to interface with the SN74HC165 8-bit parallel-load shift register. It is useful for expanding the number of digital inputs available to the autopilot, allowing you to read switches, buttons, or logic states using only 3 GPIO pins.

## **Hardware Setup**

Connect the 74HC165 to the Flight Controller's GPIO pins (Servo/Relay outputs configured as GPIO) as follows:

| 74HC165 Pin | Name | Connect To | Description |
| :---- | :---- | :---- | :---- |
| 1 | SH/LD | Autopilot GPIO (A) | Shift / Load (Latch) |
| 2 | CLK | Autopilot GPIO (B) | Clock |
| 9 | QH | Autopilot GPIO (C) | Serial Data Output |
| 15 | CLK INH | GND | Clock Inhibit |
| 10 | SER | GND (or previous QH) | Serial Input (Ground for first chip) |
| 8 | GND | GND | Ground |
| 16 | VCC | 3.3V or 5V | Power |
| 11-14, 3-6 | A-H | Digital Inputs | Parallel Data Inputs |

**Note:** Ensure your Flight Controller's GPIO voltage levels match the VCC of the 74HC165 (typically 3.3V).

## **Parameters**

The script creates the following parameters under the HC165\_ prefix:

* **HC165\_ENABLE**: Set to 1 to enable the driver.  
* **HC165\_PIN\_PL**: The GPIO pin number for the Parallel Load (SH/LD) pin.  
  * *Note: On many autopilots, pin numbers 50-55 correspond to the first 6 AUX PWM outputs.*  
* **HC165\_PIN\_CP**: The GPIO pin number for the Clock (CLK) pin.  
* **HC165\_PIN\_Q7**: The GPIO pin number for the Data (QH) pin.  
* **HC165\_WIDTH**: The number of chips chained together. Default is 1 (8 bits). Supports up to 4 (32 bits).  
* **HC165\_INVERT**: Set to 1 to invert the logic of the read bits (useful for pull-up switches).  
* **HC165\_DEBUG**: Controls GCS messages.  
  * 0: Disabled  
  * 1: Report changes only (default)  
  * 2: Report continuously

## **Usage**

1. Set SCR\_ENABLE \= 1 to enable scripting and reboot.  
2. Upload SN74HC165.lua to the APM/scripts directory on the SD card.  
3. Reboot.  
4. Configure the HC165\_ parameters for your specific wiring.  
5. The script will publish the state of the inputs as a named float HC165\_MASK.  
6. You can view HC165\_MASK in the "Quick" tab or Status tab of Mission Planner, or log it to the onboard log.

## **Output Format**

The HC165\_MASK value is an integer where each bit corresponds to an input pin on the shift register.

* Bit 7 corresponds to Input H.  
* Bit 0 corresponds to Input A.
